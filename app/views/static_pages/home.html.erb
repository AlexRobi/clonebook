<% provide(:title, "Clonebook") %>

<section id="home" class="">
  <div class="container">

    <% flash.each do |key, value| %>
      <%= content_tag :div, value, class: "alert alert-#{key} container" %>
    <% end %>
    <div class="row no-gutters">
      <div class="user-info col-md-3 d-none d-md-block">
        <div class="text-center">
          <%= link_to current_user do %>
            <%= image_tag current_user.gravatar_url, class: "rounded-circle" %>
          <% end %>
        </div>
        <div class="text-center user-info__username">
          <%= link_to current_user.username, current_user %>
        </div>
        <div class="user-info__stats">
          <div>
            <%= t('user-info.posts') %><br />
            <i><%= current_user.posts.count %></i>
          </div>
          <div>
            <%= t('user-info.friends') %><br />
            <i><%= current_user.friends.count%></i>
          </div>
        </div>
      </div>

      <div class="dol-12 col-md-8 ml-auto post__form">
        <div class="d-flex">
          <div><%= image_tag current_user.gravatar_url, class: "rounded-circle" %></div>
          <%= form_for(@post) do |f| %>
            <%= f.text_area :body, class: "col-auto form-control",
                                    placeholder: true %>
            <%= f.hidden_field :user_id, value: current_user.id %>
            <%= f.submit t('home.btn-post'), class: "btn float-right" %>
          <% end %>
        </div>
      </div>
    </div>

    <div class="ml-auto feed">
      <% if @posts.any? %>
        <% @posts.each do |post| %>
          <div class="ml-auto post">
            <div class="post__header">
              <%= link_to post.user do %>
                <%= image_tag post.user.gravatar_url, class: "rounded-circle" %>
              <% end %>
              <div>
                <%= link_to post.user.username, post.user,
                  class: "post__header__username" %>
                <div class="post__header__posted-at">
                  <%= t('home.posted_at') %>
                  <%= time_ago_in_words(post.created_at) %>
                  <% if params[:locale] == "en" %>
                    <span>ago</span>
                  <% end %>
                </div>
              </div>
            </div>
            <div class="post__body">
              <%= post.body %>
            </div>
            <div class="post__footer">
              <div>## <%= t('post.likes') %></div>
              <div><%= post.comments.count %> <%= t('post.comments') %></div>
            </div>
            <div class="post__btn">
              <div><%= fa_icon "heart" %> <%= t('post.likes') %></div>
              <a class="" data-toggle="collapse" href="#collapse<%= post.id %>"
                 role="button" aria-expanded="false" aria-controls="collapseExample">
                <%= fa_icon "comment" %> <%= t('post.comments') %>
              </a>
            </div>
            <div class="collapse comment-container" id="collapse<%= post.id %>">
              <div class="d-flex">
                <div><%= image_tag current_user.gravatar_url, class: "rounded-circle" %></div>
                <%= form_for(@comment) do |f| %>
                  <%= f.text_field :body, placeholder: true, class: "form-control" %>
                  <%= f.hidden_field :user_id, value: current_user.id %>
                  <%= f.hidden_field :post_id, value: post.id %>
                  <%= f.submit t('home.btn-post'), class: "btn" %>
                <% end %>
              </div>
              <% post.comments.each do |comment| %>
                <div class="comment">
                  <div><%= image_tag comment.user.gravatar_url, class: "rounded-circle" %></div>
                  <div class="comment__body">
                    <div>
                      <%= link_to comment.user.username, comment.user,
                        class: "comment__username" %>
                      <span>&nbsp;<%= comment.body %></span>
                    </div>
                  </div>
                </div>
              <% end %>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>
  </div>
</section>